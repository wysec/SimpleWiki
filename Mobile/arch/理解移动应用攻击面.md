# 1. 理解移动应用攻击面
全面了解一个移动应用的攻击面是成功实施安全测试的关键。当我们在对一个移动应用进行安全测试时，首先最关键的步骤就是枚举其攻击面。

## 1.1 关于攻击面

### 1.1.1 攻击面的定义
攻击面（attack surface），是指软件环境中可以被未授权用户/攻击者输入或获取数据而受到攻击的点。

一般软件程序的攻击面有如下几方面：
1. 数据或指令进出应用程序的所有路径（URI）；
2. 保护这些路径的代码（包括：对资源访问的认证，授权，活动日志，数据验证和编码等）；
3. 应用程序中使用的所有有价值数据（包括：密钥密码，用户个人信息数据，主要的业务数据等）；
4. 保护这些数据的代码（包括：加密和校验，访问审计，数据完整性和操作安全控制等）；

比如常见的Web相关应用的攻击面就有：HTTP协议，HTML、Javascript、CSS和SVG等等。特别的，从定义上来说，攻击面并不要求确实有安全漏洞。如果某个点可以被攻击者输入或获取数据，那么它就被视为一个攻击面，必须进行相应的研究分析，确定是否确实存在漏洞。

### 1.1.2 识别攻击面
通常我们可以通过一些方式来进行攻击面的识别，比如： 查看系统的架构设计文档；阅读程序的源代码；或者直接运行程序进行分析。通过这些方式可以识别程序中存在的输入数据点或获取数据点，这些点通常存在于下面的位置中。
* 用户页面的表单或字段
* HTTP头和cookies
* 应用的API
* 文件操作
* 数据存储
* 运行参数
* ... ...

此外，也可以使用扫描工具来帮助建立攻击面。可以使用一些开源扫描工具，或者一些商业的动态测试和漏洞扫描工具或服务，以此来爬取系统并映射出其中可能的攻击点。

然后可以再通过浏览系统中的一些主要用例来验证上面对攻击面的分析结果：比如：注册和创建用户账号，登录，搜索项目，下订单，更改订单等。 根据系统中的控制和数据流程，查看信息的验证方式和存储位置，涉及到哪些资源以及涉及到那些三方系统。综合上面的分析结果就基本可以确定系统的整个攻击面情况。

### 1.1.3 攻击面分析结果应用
在完成应用的攻击面分析后，就需要测试人员像攻击者一样去思考，来测试这些潜在攻击点是否存在漏洞，通过这样的方式就可以识别出系统中存在的高风险区域。这些往往也是最容易受到攻击者攻击的地方。

在进行安全测试的时候根据攻击面分析的结果进行测试。以攻击面分析的结果来指导进行安全测试，这样可以保障测试的过程和结果更加全面和系统，能够有效提高安全测试结果的全面性。因此攻击面分析是安全测试过程中非常重要的一步。


## 1.2 在移动应用安全测试中使用攻击面分析
对于移动应用程序进行安全测试时，我们可以按照上面的操作模式。首先可以查看架构设计文档或者通过阅读源代码的方式来进行分析并识别存在的攻击面，当然也可以使用一些源代码扫描工具来帮助进行分析。但是这种方式只适合在进行白盒测试的情况。

很多时候我们都只能进行黑盒测试，此时基本就只有通过运行程序来分析其业务和数据流程，从而来进行攻击面分析，先确定应用的整体架构设计，然后通过对移动应用的业务进行操作和分析，评估其可能存在的攻击点有那些。当然在此过程中也可以使用一些安全扫描工具来帮助进行攻击面分析。在实际对移动应用进行攻击面分析时，我们可以从如下一些方面来进行分析。

### 1.2.1 认证过程的攻击面
认证的目的是确认当前所声称为某种身份的用户，确实是所声称的用户。通常情况下，对用户的身份认证的基本方法有这三种：你知道什么（如：密码）；你有什么（如：短信）；你是谁（如：指纹）。

对于移动应用来说，身份认证是一个非常重要的安全功能。比较常见的认证功能的攻击面就是暴力猜测用户密码了。如果攻击者能够绕过身份认证控制，使用其他用户身份登入系统，那么这将是非常严重的漏洞问题。所以，对身份认证功能的攻击面分析将是移动应用安全测试过程的重要部分。下面内容可以在对身份认证功能进行攻击面分析时作为参考。

* 定位应用进行认证处理的位置，确定应用使用的认证方式是什么
* 当不正确的认证凭证提交多次时，是否有恰当的控制措施
* 检查需要认证后才能访问的页面是否可以在未认证情况下直接访问
* 是否使用单点登录技术，如：OAuth等
* 对重要业务的操作（如：转账、支付等）是否会进行再次身份认证

### 1.2.2 会话管理的攻击面
会话管理是在服务端用来跟踪并保持用户信息的技术。对于移动应用程序，为了在服务端认证用户后还能识别已被认证用户的后续访问，这就需要通过会话管理来控制，即用户在访问服务端系统时增加会话令牌来让服务端能够识别是那个用户的访问。若会话令牌本身存在漏洞或者被绕过，这也将导致攻击者能够使用其他用户身份访问系统，所以会话管理也是移动应用的主要攻击面。下面内容可以作为对会话管理进行攻击面分析的参考。

* 会话令牌是否存在某种规律
* 会话中是否有用户凭据或相关敏感信息
* 会话在本地以及服务器端是否都会超时

### 1.2.3 授权管理的攻击面
授权是指定与安全相关的资源的访问权限，特别是访问控制的功能。在移动应用中，当用户输入账户密码完成登录认证后，用户能够访问移动应用的那些功能，这就需要对用户进行授权管理以决定用户能够访问那些业务功能。如果授权管理控制不当或者被攻击者攻击，那么可能导致攻击者能够获得其不应有的权限，这将会是很严重的漏洞。因此授权管理也是移动应用中比较常见的攻击面。下面内容也可以作为授权管理的攻击面分析的参考。

* 确定用户是否可以访问其他角色用户的功能
* 定位来自任何不受信任源的可能在客户端上设置的标志或值
* 查找应用程序中未预期流程情况下可直接访问的位置


### 1.2.4 数据存储的攻击面
对于移动应用程序，在程序运行过程中会涉及到比较多的数据存储操作过程，比如文件存储、数据库存储等等。很多应用就是在数据存储过程中处理不当，导致安全漏洞。比如：应用将比较敏感的数据明文存储在sdcard上，而由于sdcard上的数据是所有应用都可以访问的，这就导致了应用的敏感数据泄露，这也是比较严重的问题。所以，数据存储也是移动应用的主要攻击面。下面内容也可以作为数据存储的攻击面分析时的参考。

* 是否有敏感数据存储在本地
* 应用是否使用外部存储来保存敏感信息
* 应用程序是否向文件系统写入敏感信息

### 1.2.5 加密过程的攻击面
数据加密是移动应用的重要安全功能，特别是对于敏感数据的存储、传输等都应该要进行加密处理。但是，如果对于敏感数据进行明文保存或者传输处理，那么这将会是个安全问题；即使进行了加密处理，但是如果使用了弱加密或错误的加密方式也会导致安全问题。比较常见的比如使用不安全的加密算法（如：DES）；或者将加解密密钥直接写在源代码中，这样攻击者在分析源程序的时候就可以很容易的获得这个密钥信息了，这也是比较严重的问题。所以，加解密也是移动应用的重要的攻击面。如下内容可以作为加密过程的攻击面分析时的参考。

* 应用程序使用了什么加密算法，是否符合最佳实践
* 应用的加密密钥是怎么存储的
* 应用程序中是否硬编码了密码或密钥信息

### 1.2.6 通信过程的攻击面
移动应用基本都会涉及到各种通信操作来传递数据，除了常见的如：HTTP、蓝牙、NFC等网络通信方式外；还有应用内部的进程间通信（IPC）。由于通信过程中都会涉及数据的传递，当有敏感数据进行传递时，如果处理不当就可能存在问题。比如移动应用经常会在各种公共场所使用网络，又由于这样的公共网络往往都是不安全的，如果用户在这样的网络中进行像登录这样的敏感操作，而网络中又存在攻击者进行中间人攻击的话，那么用户的登录账号密码等信息都会被泄漏，这就是很严重的安全问题。因此通信过程常常都是移动应用的主要攻击面。下面内容可以作为通信过程的攻击面分析时的参考。

* 是否使用了不安全的网络通信协议
* 用于实现协议的特定库有没有已知的漏洞
* 通信过程中是否传递了敏感数据
* 是否可以对通信过程中的敏感数据进行修改

### 1.2.7 敏感信息的攻击面
移动应用程序在处理一些错误或异常时，如果处理不当可能会导致系统内部的敏感信息显示在页面上，从而导致信息泄露；或者应用程序将一些敏感信息明文保存在用户客户端中，这样也很容易导致敏感信息泄露。因此敏感信息泄露也是移动应用中很重要的攻击面。下面列出了一些敏感信息的攻击面分析时的参考。

* 应用日志中是否记录敏感信息
* 应用是否会缓存敏感信息
* 错误处理信息中是否有敏感信息
* 使用的三方库或API的权限是什么，它们是否传输敏感信息
* 应用程序界面上是否展示了敏感信息

### 1.2.8 Web功能的攻击面
目前也有很多移动应用是使用Web开发的，这相对来说方便了应用的开发。但同时这也会导致存在Web系统中的许多攻击面也会存在于这样的移动应用中，如：跨站脚本攻击等。因此这种存在Web开发的应用就会有更多的攻击面了。下面内容可以作为Web功能的攻击面分析时的参考

* 是否对用户输入的所有数据都进行了安全检查
* 识别应用程序将不受信任的数据传输到Web视图或浏览器中的位置
* 确定应用程序是否正确的对来自不可信源的数据输出在Web页面时进行了恰当的编码处理

### 1.2.9 APP客户端的攻击面
对于移动应用的攻击面，肯定少不了移动APP客户端，由于处于用户端，因此很容易被攻击者利用。比较常见的就是对APP客户端进行反编译，攻击者就可以通过分析其代码逻辑来更进一步的对移动应用进行攻击面分析，若客户端中存在安全问题，那么这将会很容易被攻击者发现和利用；另外，攻击者还可以使用一些安全工具或框架（如：drozer）对移动应用APP进行分析，来发现其中潜在的安全问题。因此APP客户端是移动应用中非常重要的攻击面。下面也列出了一些可以作为APP客户端攻击面分析时的内容。

* 查看应用程序请求的权限以及它被授权访问的资源
* 查看应用的配置文件中是否存在不安全的配置情况
* 使用了什么三方的框架或库，它们是否存在已知的漏洞
* 是否会检测设备越狱情况，是否可以绕过越狱检测
* 是否可以对应用程序进行逆向分析
* 应用运行时是否会动态加载运行时环境外部的文件
* 识别所有的不可信的数据输入点


